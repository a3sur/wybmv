<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Winnie Simulator</title>
<style>
body {
    margin:0;
    background:#c0c0c0;
    font-family:Chicago, monospace;
    display:flex;
    justify-content:center;
    overflow:hidden;
}
.window {
    margin-top:20px;
    width:700px;
    background:#fff;
    border:2px solid #000;
    box-shadow:4px 4px #000;
}
.titlebar {
    background:#000;
    color:#fff;
    padding:4px 8px;
    font-size:14px;
    letter-spacing:0.35em;
    text-align:center;
}
.content{padding:10px;}
canvas{background:#111;display:block;margin:auto;}
#hud{
    display:flex;
    justify-content:space-between;
    margin-top:6px;
}
button{font-family:monospace;padding:4px 8px;cursor:pointer;}
.hidden{display:none;}

.archiveWindow {
    position:fixed;
    top:5vh;
    left:5vw;
    width:90vw;
    height:90vh;
    background:#fff;
    border:2px solid #000;
    box-shadow:4px 4px #000;
    display:none;
    flex-direction:column;
}

.archiveTitle {
    background:#000;
    color:#fff;
    padding:4px 8px;
    font-size:14px;
    letter-spacing:0.25em;
    text-align:center;
}

.archiveContent {
    padding:16px;
    white-space:pre;
    overflow:hidden;   /* still no scrolling */
    font-family:monospace;
    line-height:1.45;
    flex:1;
}
.archiveButtons {
    padding:10px;
    text-align:center;
}
</style>
</head>
<body>

<div class="window">
    <div class="titlebar">WINNIE-SIMULATOR.EXE</div>
    <div class="content">
        <canvas id="game" width="700" height="500"></canvas>
        <div id="hud">
            <div>Size: <span id="size">20</span></div>
            <div>Food eaten: <span id="foodCount">0</span></div>
        </div>
        <div id="popup" class="hidden" style="text-align:center;margin-top:10px;">
            <div id="popupMessage"></div>
            <button onclick="startGame()">Retry</button>
            <button onclick="location.href='../loveme.html'">Back</button>
            <button id="secretBtn" class="hidden" onclick="startSecret()">Secret</button>
        </div>
    </div>
</div>

<div class="archiveWindow" id="archiveWindow">
    <div class="archiveTitle">archive.txt</div>
    <div class="archiveContent" id="archiveContent">
To hold her hand is to grasp the moon in my palm. The sky and stars, the sun and all space, contained within her eyes. 

When I am graced with her gaze, I become the wealthiest man to ever walk the Earth. My wallet never holds more than a twenty and some change, but in her embrace, I am richer than any other.

She is my desire. She, the fire blazing in my heart. Her smile, the fuel that makes my heart beat and beat faster. To have her by my side is a blessing like no other.

I could live all of twenty lifetimes, live the lives of twenty people, and Iâ€™d seek her every time. My heart flutters when I hear her voice, my chest aches in her absence.

My mind, filled with thoughts of her. My beautiful princess, my love, my yearning. You fill the world with such brightness and vitality, I can scarce believe it was ever so bright before your arrival.

And for you, I give my all.
    </div>
    <div class="archiveButtons">
        <button onclick="archiveWindow.style.display='none'">Back</button>
    </div>
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const sizeEl = document.getElementById("size");
const foodEl = document.getElementById("foodCount");
const popup = document.getElementById("popup");
const popupMessage = document.getElementById("popupMessage");
const secretBtn = document.getElementById("secretBtn");
const archiveWindow = document.getElementById("archiveWindow");

let player, foods, enemies, collected, playing, frame;
let mouse = {x:350,y:250};
let devBuffer="";

// Constants
const PLAYER_SPEED = 2.0;  
const ENEMY_MAX_SPEED = 1.7;
const INITIAL_FOOD = 200;
const INITIAL_ENEMIES = 20;
const FOOD_RADIUS = 10;
const MAP_RANGE = 8000;
const END_SIZE = 300;

function startGame(){
    player = {x:0,y:0,r:20};
    foods = [];
    enemies = [];
    collected = 0;
    frame = 0;
    playing = true;
    popup.classList.add("hidden");
    secretBtn.classList.add("hidden");
    archiveWindow.style.display='none';

    for(let i=0;i<INITIAL_FOOD;i++) foods.push(randomFood());
    for(let i=0;i<INITIAL_ENEMIES;i++) enemies.push(randomEnemy());

    updateHUD();
    requestAnimationFrame(loop);
}

function randomFood(){
    return {
        x: Math.random()*MAP_RANGE-MAP_RANGE/2,
        y: Math.random()*MAP_RANGE-MAP_RANGE/2,
        type: Math.random()<0.5?"ðŸ§€":"ðŸ—",
        r:FOOD_RADIUS
    };
}

function randomEnemy(){
    return {
        x: Math.random()*MAP_RANGE-MAP_RANGE/2,
        y: Math.random()*MAP_RANGE-MAP_RANGE/2,
        r: 10+Math.random()*15,
        speed: ENEMY_MAX_SPEED
    };
}

canvas.addEventListener("mousemove", e=>{
    const rect = canvas.getBoundingClientRect();
    mouse.x = e.clientX - rect.left;
    mouse.y = e.clientY - rect.top;
});

document.addEventListener("keydown",e=>{
    devBuffer += e.key.toLowerCase();
    if(devBuffer.endsWith("dev14")) player.r += 50;
    if(devBuffer.endsWith("dev26")) showPopup(true);
    if(devBuffer.length>10) devBuffer="";
});

function updatePlayer(){
    let dx = mouse.x - canvas.width/2;
    let dy = mouse.y - canvas.height/2;
    let dist = Math.sqrt(dx*dx + dy*dy);
    if(dist>1){
        dx/=dist; dy/=dist;
        player.x += dx*PLAYER_SPEED;
        player.y += dy*PLAYER_SPEED;
    }
}

function updateHUD(){
    sizeEl.textContent = Math.floor(player.r);
    foodEl.textContent = collected;
}

function loop(){
    if(!playing) return;
    frame++;
    ctx.clearRect(0,0,canvas.width,canvas.height);

    updatePlayer();
    ctx.save();
    const scale = Math.min(1.0, 40/(player.r+20));
    ctx.translate(canvas.width/2 - player.x*scale, canvas.height/2 - player.y*scale);
    ctx.scale(scale,scale);

    if(foods.length<250){
        for(let i=0;i<5;i++) foods.push(randomFood());
    }

    foods.forEach(f=>{
        ctx.font="20px monospace";
        ctx.fillText(f.type,f.x,f.y);
        let dx=f.x-player.x, dy=f.y-player.y;
        if(Math.sqrt(dx*dx+dy*dy)<player.r){
            f.x = Math.random()*MAP_RANGE-MAP_RANGE/2;
            f.y = Math.random()*MAP_RANGE-MAP_RANGE/2;
            player.r += 1;
            collected++;
            updateHUD();
        }
    });

    if(frame%600===0) enemies.push(randomEnemy());

    enemies.forEach(e=>{
        let dxp = player.x - e.x;
        let dyp = player.y - e.y;
        let distp = Math.sqrt(dxp*dxp + dyp*dyp);
        let speed = Math.min(PLAYER_SPEED-0.2, e.speed);

        if(player.r > e.r){
            e.x += dxp/distp*speed;
            e.y += dyp/distp*speed;
        } else {
            e.x -= dxp/distp*speed;
            e.y -= dyp/distp*speed;
        }

        if(distp<player.r+e.r){
            if(player.r>e.r){
                player.r += e.r/2;
                e.x = Math.random()*MAP_RANGE-MAP_RANGE/2;
                e.y = Math.random()*MAP_RANGE-MAP_RANGE/2;
                updateHUD();
            } else {
                playing=false;
                showPopup(false);
            }
        }

        ctx.fillStyle="red";
        ctx.beginPath();
        ctx.arc(e.x,e.y,e.r,0,Math.PI*2);
        ctx.fill();
    });

    ctx.fillStyle="lime";
    ctx.beginPath();
    ctx.arc(player.x,player.y,player.r,0,Math.PI*2);
    ctx.fill();

    ctx.restore();

    if(player.r>=END_SIZE){
        playing=false;
        showPopup(true);
    } else {
        requestAnimationFrame(loop);
    }
}

function showPopup(secretAvailable){
    popup.classList.remove("hidden");
    if(secretAvailable){
        popupMessage.textContent = "You reached massive size!";
        secretBtn.classList.remove("hidden");
    } else {
        popupMessage.textContent = "You were eaten! Try again.";
        secretBtn.classList.add("hidden");
    }
}

function startSecret(){
    archiveWindow.style.display='flex';
}

startGame();
</script>

</body>
</html>
