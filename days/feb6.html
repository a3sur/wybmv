<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Retro Fishing</title>
<style>
body{
    margin:0;
    background:#7ec0ee;
    font-family:Chicago, monospace;
    display:flex;
    justify-content:center;
}
.window{
    margin-top:20px;
    width:640px;
    background:#fff;
    border:2px solid #000;
    box-shadow:4px 4px #000;
}
.titlebar{
    background:#003366;
    color:#fff;
    padding:6px;
    text-align:center;
    letter-spacing:0.2em;
}
.content{padding:10px;text-align:center;}
canvas{
    background:#1e90ff;
    border:2px solid #000;
}
button{
    font-family:monospace;
    padding:4px 12px;
    margin:6px;
    cursor:pointer;
}
#lives{margin-top:4px;}
#endmsg{margin-top:8px;}
.status{
    margin-top:16px;
    font-size:14px;
}
.online{
    color:green;
    font-weight:bold;
}
.aol{
    font-size:22px;
    letter-spacing:0.3em;
    margin-bottom:10px;
}
</style>
</head>
<body>

<div class="window">
    <div class="titlebar">ICE-FISHING.EXE</div>
    <div class="content">
        <canvas id="game" width="600" height="360"></canvas>
        <div>
            Fish: <span id="score">0</span>
            <span id="high" style="display:none">
                | High: <span id="highscore">0</span>
            </span>
        </div>
        <div id="lives"></div>
        <div id="controls">
            <button onclick="startGame(false)">Start / Reset</button>
            <button onclick="startGame(true)">Endless</button>
        </div>
        <div id="endmsg"></div>
    </div>
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

let hookY = 180;
let fish = [], hazards = [];
let score = 0, playing = false, endless = false;
let lives = 3;
let highscore = localStorage.getItem("fishHigh") || 0;
let devBuffer = ""; // For Dev26

document.getElementById("highscore").textContent = highscore;

// Hook follows mouse
canvas.addEventListener("mousemove", e => {
    const r = canvas.getBoundingClientRect();
    hookY = e.clientY - r.top;
});

function drawLives() {
    document.getElementById("lives").textContent =
        "Lives: " + "ü™±".repeat(lives);
}

// Start/reset game
function startGame(isEndless) {
    endless = isEndless;
    playing = true;
    score = 0;
    lives = 3;
    hookY = 180;
    fish = [];
    hazards = [];
    document.getElementById("score").textContent = score;
    document.getElementById("endmsg").innerHTML = "";
    document.getElementById("high").style.display = endless ? "inline" : "none";
    drawLives();
    spawn(); // start spawning now that game is active
}

// Spawn fish and hazards
function spawn() {
    if (!playing) return;

    // Fish spawn
    fish.push({x: 600, y: rand(40, 320), r: 8});
    // Hazard 35% chance
    if (Math.random() < 0.35) hazards.push({x: 600, y: rand(40, 320), r: 10});

    setTimeout(spawn, 900);
}

// Game loop
function loop() {
    ctx.clearRect(0, 0, 600, 360);

    // Draw dock
    ctx.fillStyle = "#654321";
    ctx.fillRect(290, 0, 20, 20);

    // Draw line
    ctx.strokeStyle = "#000";
    ctx.beginPath();
    ctx.moveTo(300, 0);
    ctx.lineTo(300, hookY);
    ctx.stroke();

    // Draw hook
    ctx.fillStyle = "silver";
    ctx.beginPath();
    ctx.arc(300, hookY, 6, 0, Math.PI * 2);
    ctx.fill();

    if (playing) {
        // Fish movement
        fish.forEach(f => {
            f.x -= 1.5;
            ctx.fillStyle = "orange";
            ctx.beginPath();
            ctx.arc(f.x, f.y, f.r, 0, Math.PI * 2);
            ctx.fill();

            if (Math.abs(f.x - 300) < 8 && Math.abs(f.y - hookY) < 8) {
                score++;
                document.getElementById("score").textContent = score;
                f.x = -100; // remove fish

                if (!endless && score >= 30) {
                    playing = false;
                    setTimeout(showAOL, 800);
                }
            }
        });

        // Hazard movement
        hazards.forEach(h => {
            h.x -= 1.2;
            ctx.fillStyle = "red";
            ctx.beginPath();
            ctx.arc(h.x, h.y, h.r, 0, Math.PI * 2);
            ctx.fill();

            if (Math.abs(h.x - 300) < 8 && Math.abs(h.y - hookY) < 8) {
                h.x = -100;
                lives--;
                drawLives();
                if (lives <= 0) {
                    playing = false;
                    showDeathMessage();
                }
            }
        });

        // Endless highscore
        if (endless && score > highscore) {
            highscore = score;
            localStorage.setItem("fishHigh", highscore);
            document.getElementById("highscore").textContent = highscore;
        }
    }

    requestAnimationFrame(loop);
}

function showDeathMessage() {
    document.getElementById("endmsg").innerHTML =
        "<strong>Out of bait.</strong><br>" +
        "<button onclick='startGame(" + endless + ")'>Retry</button>" +
        "<button onclick='location.reload()'>Back</button>";
}

// AOL screen
function showAOL() {
    document.body.innerHTML = `
    <div class="window" style="margin-top:60px;width:420px;">
        <div class="titlebar">WELCOME</div>
        <div class="content">
            <div class="aol">A O L</div>
            <div class="status">
                Username: <strong>xXx_lard305_xXx</strong><br>
                Status: <span class="online">‚óè Online</span>
            </div>
            <br>
            <button onclick="location.href='mailto:andrewhlee715@gmail.com'">
                Send me a message!
            </button>
            <br><br>
            <button onclick="location.reload()">Back</button>
        </div>
    </div>`;
}

// Random helper
function rand(a, b) { return Math.random() * (b - a) + a; }

// DEV26 key listener to go **directly to AOL screen**
document.addEventListener("keydown", e => {
    devBuffer += e.key.toLowerCase();
    if (devBuffer.endsWith("dev26")) showAOL();
    if (devBuffer.length > 10) devBuffer = "";
});

// Start loop
loop();
</script>

</body>
</html>
