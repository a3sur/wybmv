<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Retro Fishing</title>
<style>
body{
    margin:0;
    background:#7ec0ee;
    font-family:Chicago, monospace;
    display:flex;
    justify-content:center;
}
.window{
    margin-top:20px;
    width:640px;
    background:#fff;
    border:2px solid #000;
    box-shadow:4px 4px #000;
}
.titlebar{
    background:#003366;
    color:#fff;
    padding:6px;
    text-align:center;
    letter-spacing:0.2em;
}
.content{padding:10px;text-align:center;}
canvas{
    background:#1e90ff;
    border:2px solid #000;
}
button{
    font-family:monospace;
    padding:4px 12px;
    margin:6px;
    cursor:pointer;
}
.hidden{display:none;}
#popup{
    position:absolute;
    top:40%;
    left:50%;
    transform:translate(-50%,-50%);
    background:#fff;
    border:2px solid #000;
    padding:20px;
    box-shadow:4px 4px #000;
}
</style>
</head>
<body>

<div class="window">
    <div class="titlebar">ICE-FISHING.EXE</div>
    <div class="content">
        <canvas id="game" width="600" height="360"></canvas>
        <div>
            Fish: <span id="score">0</span>
            <span id="high" class="hidden"> | High: <span id="highscore">0</span></span>
        </div>
        <div id="controls">
            <button onclick="startGame(false)">Start</button>
            <button onclick="startGame(true)">Endless</button>
        </div>
    </div>
</div>

<div id="popup" class="hidden"></div>

<script>
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");

let hookY, fish=[], hazards=[];
let score=0, playing=false, endless=false;
let highscore=localStorage.getItem("fishHigh")||0;

document.getElementById("highscore").textContent=highscore;

function startGame(isEndless){
    endless=isEndless;
    score=0;
    hookY=20;
    fish=[];
    hazards=[];
    playing=true;

    document.getElementById("score").textContent=0;
    document.getElementById("high").classList.toggle("hidden",!endless);

    spawnLoop();
    loop();
}

canvas.addEventListener("mousemove",e=>{
    const r=canvas.getBoundingClientRect();
    hookY=e.clientY-r.top;
});

function spawnLoop(){
    if(!playing) return;
    fish.push({x:600,y:rand(40,320),r:8});
    if(Math.random()<0.4)
        hazards.push({x:600,y:rand(40,320),r:10});
    setTimeout(spawnLoop,700);
}

function loop(){
    if(!playing) return;
    ctx.clearRect(0,0,600,360);

    // ice hole
    ctx.fillStyle="#000";
    ctx.fillRect(290,0,20,20);

    // line + hook
    ctx.strokeStyle="#000";
    ctx.beginPath();
    ctx.moveTo(300,20);
    ctx.lineTo(300,hookY);
    ctx.stroke();

    ctx.fillStyle="silver";
    ctx.beginPath();
    ctx.arc(300,hookY,6,0,Math.PI*2);
    ctx.fill();

    fish.forEach(f=>{
        f.x-=2;
        ctx.fillStyle="orange";
        ctx.beginPath();
        ctx.arc(f.x,f.y,f.r,0,Math.PI*2);
        ctx.fill();

        if(Math.abs(f.x-300)<8 && Math.abs(f.y-hookY)<8){
            score++;
            document.getElementById("score").textContent=score;
            f.x=-100;
            if(!endless && score>=30) win();
        }
    });

    hazards.forEach(h=>{
        h.x-=3;
        ctx.fillStyle="red";
        ctx.beginPath();
        ctx.arc(h.x,h.y,h.r,0,Math.PI*2);
        ctx.fill();

        if(Math.abs(h.x-300)<8 && Math.abs(h.y-hookY)<8){
            lose();
        }
    });

    if(endless && score>highscore){
        highscore=score;
        localStorage.setItem("fishHigh",highscore);
        document.getElementById("highscore").textContent=highscore;
    }

    requestAnimationFrame(loop);
}

function win(){
    playing=false;
    popup("Redirecting...",()=>{
        showQuiz();
    });
}

function lose(){
    playing=false;
    popup("You lost!",()=>{
        popup(`
            <button onclick="startGame(${endless})">Retry</button>
            <button onclick="location.reload()">Back</button>
        `,null,true);
    });
}

function popup(text,cb,raw){
    const p=document.getElementById("popup");
    p.innerHTML=raw?text:`<div>${text}</div>`;
    p.classList.remove("hidden");
    if(cb){
        setTimeout(()=>{
            p.classList.add("hidden");
            cb();
        },2000);
    }
}

function showQuiz(){
    document.body.innerHTML=`
    <div class="window">
        <div class="titlebar">QUIZ.TXT</div>
        <div class="content">
            <form action="mailto:YOUR_EMAIL_HERE@example.com" method="post" enctype="text/plain">
                <p>1. Favorite fish?</p>
                <input name="Q1"><br><br>
                <p>2. Did you enjoy this?</p>
                <input name="Q2"><br><br>
                <p>3. Endless or Normal?</p>
                <input name="Q3"><br><br>

                <button type="submit">Send</button>
                <button type="button" onclick="location.reload()">Back</button>
            </form>
        </div>
    </div>
    `;
}

function rand(a,b){return Math.random()*(b-a)+a;}
</script>

</body>
</html>
