<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Heart Dash</title>
<style>
body{
    margin:0;
    overflow-x:hidden;
    background:linear-gradient(#ffd6e7,#ff9ec4);
    font-family:Arial, sans-serif;
    text-align:center;
}

canvas{
    display:block;
    margin:0 auto;
    background:#fff0f6;
}

#ui{
    position:absolute;
    top:10px;
    left:50%;
    transform:translateX(-50%);
    font-size:20px;
    font-weight:bold;
}

#gameOver{
    position:absolute;
    top:50%;
    left:50%;
    transform:translate(-50%,-50%);
    font-size:28px;
    display:none;
}

#poem{
    max-width:800px;
    margin:60px auto 120px auto;
    padding:40px;
    font-size:26px;
    line-height:1.6;
    background:white;
    border-radius:20px;
    box-shadow:0 20px 40px rgba(0,0,0,0.2);
    opacity:0;
    transform:translateY(40px);
    transition:all 1.2s ease;
}

#poem.reveal{
    opacity:1;
    transform:translateY(0);
}

#backContainer{
    margin:40px 0 80px 0;
}

#backButton{
    padding:15px 40px;
    font-size:20px;
    border:none;
    border-radius:12px;
    background:#ff2e88;
    color:white;
    cursor:pointer;
    box-shadow:0 10px 20px rgba(0,0,0,0.2);
    transition:0.2s;
}

#backButton:hover{
    transform:scale(1.05);
}

</style>
</head>
<body>

<div id="ui">Hearts: 0</div>
<div id="gameOver">Game Over<br>Press R to Restart</div>

<canvas id="game" width="800" height="400"></canvas>

<div id="poem">
    <h2>mirror, mirror</h2>
    <p>
    Mirror mirror on the wall, <br>
    Who's the lardest of them all?<br>
    Winnie-wan, the mirror says,<br>
    I'm wowed, this mirror deserves flores!<br>
    If you know, mirror, who is the sickest?<br>
    Lucy, dear sir, says this mirror, the quickest.
    I say gee whiz, this mirror's a wiz!<br>
    Well then mirror, its time for a quiz!!<br>
    Mirror mirror, I then ask,<br>
    Who is the dumbest, if you're up to the task?<br>
    This task, I took; tis Jolene, simply put.
    Astonished, I was, what an accurate output!<br>
    Maybe the mirror I mistook, and, if so<br>
    Do you happen to know, the <b>prettiest</b>, I go<br>
    But quickly cut off before I could finish,<br>
    The mirror's speed, that none could diminish,<br>
    It is, obviously, Kaithlyn Clark.
    </p>
</div>

<div id="backContainer">
    <button id="backButton">â¬… Back</button>
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

const groundY = 320;

let player = {
    x:100,
    y:groundY,
    size:40,
    vy:0,
    jumping:false,
    rotation:0
};

let gravity = 0.8;
let maxJumpHold = 18;
let jumpHoldTime = 0;
let isHoldingJump = false;

let obstacles = [];
let hearts = [];
let platforms = [];

let score = 0;
let speed = 4;
let gameRunning = true;
let poemRevealed = false;

/* SPAWN */

function spawnObstacle(){
    obstacles.push({
        x:canvas.width,
        y:groundY,
        width:30,
        height:60
    });
}

function spawnPlatformSet(){
    let height = 240 - Math.random()*60;
    platforms.push({
        x:canvas.width,
        y:height,
        width:120,
        height:15
    });

    hearts.push({
        x:canvas.width + 60,
        y:height - 40,
        size:18
    });
}

function spawnGroundHeart(){
    hearts.push({
        x:canvas.width,
        y:300,
        size:18
    });
}

setInterval(()=>{ if(gameRunning) spawnObstacle(); }, 2200);
setInterval(()=>{ if(gameRunning) spawnPlatformSet(); }, 4000);
setInterval(()=>{ if(gameRunning) spawnGroundHeart(); }, 1800);

/* DRAW */

function drawCube(){
    ctx.save();
    ctx.translate(player.x + player.size/2, player.y + player.size/2);
    ctx.rotate(player.rotation);
    ctx.fillStyle="#ff2e88";
    ctx.fillRect(-player.size/2, -player.size/2, player.size, player.size);
    ctx.restore();
}

function drawObstacle(o){
    ctx.fillStyle="#444";
    ctx.fillRect(o.x, o.y, o.width, o.height);
}

function drawPlatform(p){
    ctx.fillStyle="#8e44ad";
    ctx.fillRect(p.x, p.y, p.width, p.height);
}

function drawHeart(h){
    ctx.fillStyle="red";
    ctx.beginPath();
    let x=h.x, y=h.y, s=h.size;
    ctx.moveTo(x,y);
    ctx.bezierCurveTo(x-s/2,y-s/2,x-s,y+s/3,x,y+s);
    ctx.bezierCurveTo(x+s,y+s/3,x+s/2,y-s/2,x,y);
    ctx.fill();
}

/* LOOP */

function update(){
    if(!gameRunning) return;

    ctx.clearRect(0,0,canvas.width,canvas.height);

    ctx.fillStyle="#333";
    ctx.fillRect(0,360,canvas.width,40);

    if(isHoldingJump && jumpHoldTime < maxJumpHold){
        player.vy -= 0.6;
        jumpHoldTime++;
    }

    player.vy += gravity;
    player.y += player.vy;

    let onPlatform = false;

    for(let i=platforms.length-1;i>=0;i--){
        let p = platforms[i];
        p.x -= speed;
        drawPlatform(p);

        if(p.x + p.width < 0){
            platforms.splice(i,1);
            continue;
        }

        if(player.vy >= 0 &&
           player.x + player.size > p.x &&
           player.x < p.x + p.width &&
           player.y + player.size >= p.y &&
           player.y + player.size <= p.y + 20){
                player.y = p.y - player.size;
                player.vy = 0;
                player.jumping = false;
                jumpHoldTime = 0;
                onPlatform = true;
        }
    }

    if(player.y >= groundY && !onPlatform){
        player.y = groundY;
        player.vy = 0;
        player.jumping = false;
        jumpHoldTime = 0;
        player.rotation = Math.round(player.rotation / (Math.PI/2)) * (Math.PI/2);
    }

    if(player.jumping){
        player.rotation += 0.15;
    }

    drawCube();

    for(let i=obstacles.length-1;i>=0;i--){
        let o = obstacles[i];
        o.x -= speed;
        drawObstacle(o);

        if(o.x + o.width < 0){
            obstacles.splice(i,1);
        }

        if(player.x < o.x+o.width &&
           player.x+player.size > o.x &&
           player.y < o.y+o.height &&
           player.y+player.size > o.y){
               gameOver();
        }
    }

    for(let i=hearts.length-1;i>=0;i--){
        let h = hearts[i];
        h.x -= speed;
        drawHeart(h);

        if(h.x < 0){
            hearts.splice(i,1);
        }

        if(player.x < h.x+h.size &&
           player.x+player.size > h.x-h.size &&
           player.y < h.y+h.size &&
           player.y+player.size > h.y-h.size){

               score++;
               document.getElementById("ui").innerText="Hearts: "+score;
               hearts.splice(i,1);

               if(score >= 15 && !poemRevealed){
                   poemRevealed = true;
                   document.getElementById("poem").classList.add("reveal");
               }
        }
    }

    speed += 0.0005;
    requestAnimationFrame(update);
}

/* CONTROLS */

function jumpStart(){
    if(!player.jumping && gameRunning){
        player.vy = -10;
        player.jumping = true;
        isHoldingJump = true;
        jumpHoldTime = 0;
    }
}

function jumpEnd(){
    isHoldingJump = false;
}

function gameOver(){
    gameRunning=false;
    document.getElementById("gameOver").style.display="block";
}

function restart(){
    obstacles=[];
    hearts=[];
    platforms=[];
    score=0;
    speed=4;
    player.y=groundY;
    player.vy=0;
    player.rotation=0;
    poemRevealed=false;
    document.getElementById("poem").classList.remove("reveal");
    gameRunning=true;
    document.getElementById("ui").innerText="Hearts: 0";
    document.getElementById("gameOver").style.display="none";
    update();
}

document.addEventListener("keydown",(e)=>{
    if(e.code==="Space" || e.code==="ArrowUp"){
        e.preventDefault(); // stops page scroll
        jumpStart();
    }
    if(e.code==="KeyR"){
        restart();
    }
});
document.addEventListener("keyup",(e)=>{
    if(e.code==="Space" || e.code==="ArrowUp"){
        e.preventDefault(); // stops page scroll
        jumpEnd();
    }
});
update();

document.getElementById("backButton").addEventListener("click", function(){
    window.location.href = "/index.html";
});

</script>
</body>
</html>
