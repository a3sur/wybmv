<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Feb 3</title>
<style>
body {
    margin: 0;
    background: #bbb;
    font-family: Chicago, monospace;
    display: flex;
    align-items: center;
    justify-content: center;
    height: 100vh;
    overflow: hidden;
}

/* Windows */
.window {
    width: 540px;
    background: #eee;
    border: 2px solid #000;
    box-shadow: 6px 6px #555;
    position: relative;
}

.titlebar {
    background: #ddd;
    padding: 4px;
    border-bottom: 2px solid #000;
    text-align: center;
    font-weight: bold;
}

.content {
    padding: 8px;
    text-align: center;
}

/* Canvas */
canvas {
    background: black;
    border: 2px inset #999;
}

/* Hidden */
.hidden { display: none; }

/* Shake screen */
@keyframes shake {
    0% { transform: translate(0,0); }
    25% { transform: translate(-8px,6px); }
    50% { transform: translate(8px,-6px); }
    75% { transform: translate(-6px,-8px); }
    100% { transform: translate(0,0); }
}
.shake {
    animation: shake .15s infinite;
}

/* Boss explosion */
@keyframes explode {
    0% { transform: scale(1); opacity: 1; }
    60% { transform: scale(1.6); opacity: .7; }
    100% { transform: scale(2.2); opacity: 0; }
}
.explode {
    animation: explode .9s ease-out forwards;
}

/* Gallery */
.gallery {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 12px;
    max-height: 320px;
    overflow-y: auto;
    padding: 8px;
}

.photo {
    width: 100%;
    height: 160px;
    object-fit: cover;
    border: 1px solid #000;
    background: #ccc;
    opacity: 0;
    transform: scale(.9);
    transition: all .5s ease;
}

.photo.visible {
    opacity: 1;
    transform: scale(1);
}

button {
    margin-top: 10px;
    font-family: monospace;
}
</style>
</head>
<body>

<!-- GAME -->
<div class="window" id="gameWindow">
    <div class="titlebar">Galaga</div>
    <div class="content">
        <canvas id="game" width="500" height="320"></canvas>
        <div id="status">Enemies left: 20</div>
    </div>
</div>

<!-- GALLERY -->
<div class="window hidden" id="galleryWindow">
    <div class="titlebar">Photo Gallery</div>
    <div class="content">
        <div class="gallery" id="gallery">
            <!-- 20 placeholders -->
            ${Array.from({length:20},(_,i)=>`<img class="photo" src="https://via.placeholder.com/400?text=${i+1}">`).join("")}
        </div>
        <button onclick="location.href='loveme.html'">Back</button>
    </div>
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const statusText = document.getElementById("status");

let player, bullets, enemyBullets, enemies, boss;
let wave, phase, loop, lives;

let lastShot = 0;
const SHOT_COOLDOWN = 250;
const MAX_BULLETS = 3;

/* ================= RESET ================= */
function resetGame() {
    player = { x: 240, y: 285 };
    bullets = [];
    enemyBullets = [];
    enemies = [];
    boss = null;

    wave = 1;
    phase = "wave";
    lives = 3;

    spawnWave(6);
    statusText.textContent = "Wave 1 â€” Enemies left: 6 | Lives: 3";

    if (loop) clearInterval(loop);
    loop = setInterval(update, 30);
}

/* ================= INPUT ================= */
document.addEventListener("keydown", e => {
    if (e.key === "ArrowLeft") player.x -= 10;
    if (e.key === "ArrowRight") player.x += 10;

    /* Wraparound */
    if (player.x < -20) player.x = canvas.width;
    if (player.x > canvas.width) player.x = -20;

    if (e.key === " ") {
        const now = Date.now();
        if (now - lastShot > SHOT_COOLDOWN && bullets.length < MAX_BULLETS) {
            bullets.push({ x: player.x + 10, y: player.y });
            lastShot = now;
        }
    }
});

/* ================= WAVES ================= */
function spawnWave(num) {
    enemies = [];
    let cols = wave === 1 ? 3 : wave === 2 ? 4 : 6;

    for (let i = 0; i < num; i++) {
        const col = i % cols;
        const row = Math.floor(i / cols);
        enemies.push({
            x: 80 + col * 70,
            y: 40 + row * 40,
            baseX: 80 + col * 70,
            baseY: 40 + row * 40,
            alive: true,
            dive: false,
            t: 0,
            reshuffled: false
        });
    }
}

/* ================= FORMATION SHUFFLE ================= */
function reshuffleFormation() {
    enemies.forEach((e, i) => {
        const col = i % (wave + 2);
        const row = Math.floor(i / (wave + 2));
        e.baseX = 60 + col * 75;
        e.baseY = 40 + row * 45;
    });
}

/* ================= UPDATE ================= */
function update() {
    ctx.clearRect(0,0,canvas.width,canvas.height);

    /* Player */
    ctx.fillStyle = "lime";
    ctx.fillRect(player.x, player.y, 20, 10);

    /* Player bullets */
    bullets.forEach(b => {
        b.y -= 6;
        ctx.fillRect(b.x, b.y, 2, 6);
    });
    bullets = bullets.filter(b => b.y > -10);

    /* Enemy bullets */
    ctx.fillStyle = "orange";
    enemyBullets.forEach(b => {
        b.y += 3 + wave * 0.4;
        ctx.fillRect(b.x, b.y, 3, 6);
    });
    enemyBullets = enemyBullets.filter(b => b.y < 330);

    /* Player hit */
    enemyBullets.forEach(b => {
        if (
            b.x > player.x && b.x < player.x + 20 &&
            b.y > player.y && b.y < player.y + 10
        ) {
            b.y = 999;
            lives--;
        }
    });

    if (lives <= 0) {
        gameOver();
        return;
    }

    /* ===== WAVE PHASE ===== */
    if (phase === "wave") {
        ctx.font = "16px monospace";
        ctx.textAlign = "center";

        const aliveCount = enemies.filter(e => e.alive).length;

        /* Mid-wave reshuffle */
        if (aliveCount <= Math.ceil(enemies.length / 2)) {
            if (!enemies[0].reshuffled) {
                reshuffleFormation();
                enemies.forEach(e => e.reshuffled = true);
            }
        }

        enemies.forEach(e => {
            if (!e.alive) return;

            if (!e.dive && Math.random() < 0.0015 * wave) {
                e.dive = true;
                e.t = 0;
            }

            if (e.dive) {
                e.t += 0.03 + wave * 0.007;
                e.y += 1.5 + wave * 0.4;
                e.x = e.baseX + Math.sin(e.t * 4) * (28 + wave * 3);

                if (Math.random() < 0.002 * wave) {
                    enemyBullets.push({ x: e.x + 10, y: e.y + 12 });
                }

                if (e.y > 260) {
                    e.y = e.baseY;
                    e.dive = false;
                }
            } else {
                /* Slide back into formation */
                e.x += (e.baseX - e.x) * 0.05;
                e.y += (e.baseY - e.y) * 0.05;
            }

            ctx.fillText("ðŸ‘¾", e.x + 10, e.y + 14);

            bullets.forEach(b => {
                if (
                    b.x > e.x && b.x < e.x + 20 &&
                    b.y > e.y && b.y < e.y + 18
                ) {
                    e.alive = false;
                    b.y = -10;
                }
            });
        });

        statusText.textContent =
            `Wave ${wave} â€” Enemies left: ${aliveCount} | Lives: ${lives}`;

        if (aliveCount === 0) {
            if (wave === 1) { wave = 2; spawnWave(9); }
            else if (wave === 2) { wave = 3; spawnWave(12); }
            else {
                phase = "boss";
                boss = {
                    x: 200,
                    y: 40,
                    hp: 25,
                    rage: false,
                    t: 0
                };
            }
        }
    }

    /* ===== BOSS ===== */
    if (phase === "boss") {
        boss.t += 0.04;

        /* Rage mode */
        if (boss.hp <= 10) boss.rage = true;

        if (boss.rage) {
            boss.y += 2;
            boss.x = 200 + Math.sin(boss.t * 3) * 120;
            if (Math.random() < 0.06) {
                enemyBullets.push({
                    x: boss.x + 50,
                    y: boss.y + 25
                });
            }
        } else {
            boss.x += Math.sin(boss.t) * 2;
            if (Math.random() < 0.03) {
                enemyBullets.push({
                    x: boss.x + Math.random() * 100,
                    y: boss.y + 25
                });
            }
        }

        ctx.fillStyle = boss.rage ? "crimson" : "purple";
        ctx.fillRect(boss.x, boss.y, 100, 25);

        bullets.forEach(b => {
            if (
                b.x > boss.x && b.x < boss.x + 100 &&
                b.y > boss.y && b.y < boss.y + 25
            ) {
                boss.hp--;
                b.y = -10;
            }
        });

        statusText.textContent =
            `Boss HP: ${boss.hp} | Lives: ${lives}`;

        if (boss.hp <= 0) win();
    }
}

/* ================= STATES ================= */
function gameOver() {
    clearInterval(loop);
    statusText.innerHTML = `
        GAME OVER<br>
        <button onclick="resetGame()">START OVER?</button>
    `;
}

function win() {
    clearInterval(loop);
    document.body.classList.add("shake");

    setTimeout(() => {
        document.getElementById("gameWindow").classList.add("explode");
    }, 600);

    setTimeout(() => {
        document.body.classList.remove("shake");
        document.getElementById("gameWindow").classList.add("hidden");
        document.getElementById("galleryWindow").classList.remove("hidden");
        observeGallery();
    }, 1400);
}

/* ================= DEV KEYS ================= */
(() => {
    let buffer = "";
    document.addEventListener("keydown", e => {
        buffer += e.key.toLowerCase();
        buffer = buffer.slice(-5);

        if (buffer === "dev14") {
            if (phase === "wave") enemies.forEach(e => e.alive = false);
            if (phase === "boss") boss.hp = 0;
        }

        if (buffer === "dev26") {
            win();
        }
    });
})();

/* ================= GALLERY ================= */
function observeGallery() {
    const imgs = document.querySelectorAll(".photo");
    const obs = new IntersectionObserver(entries => {
        entries.forEach(e => {
            if (e.isIntersecting) e.target.classList.add("visible");
        });
    }, { threshold: 0.2 });
    imgs.forEach(i => obs.observe(i));
}

resetGame();
</script>

    
</body>
</html>



